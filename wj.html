<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="favicon.ico">
        <title>123</title>

              <link rel="stylesheet" href="static/css/bootstrap.min.css">
              <script src="static/js/jquery-2.1.4.min.js"></script>
              <script src="static/js/bootstrap.min.js"></script>
              <script src="static/js/layer/layer.js"></script>
              <script src="static/js/template-web.js"></script>


    </head>
<style>
    .radio-inline {
        margin-bottom: 10px;
        border: 1px solid #00aaee;
        padding: 5px;
        padding-left: 25px;
        border-radius: 10px;
        margin-left: 10px;
    }
</style>
<body>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=65913753" charset="UTF-8"></script>

<script type="text/html" id="script_title">
    <p style="padding-top: 35px;font-size: 34px;"><%=title%></p>
    <p style="font-size: 18px;"><%-info%></p>
</script>

<script type="text/html" id="SingleChoice">
    <div class="form-inline">
        <div class="form-group" id="q<%=no%>">
            <label><%=title%></label>
            <br>
            <% for(var i = 0; i < opt.length; i++){ %>
            <label class="radio-inline">
                <input class="radio-input" type="radio" name="q<%=no%>" value="<%=score[i]%>"><%=opt[i]%>
            </label>
            <% } %>
        </div>
    </div>
    <hr>
</script>
<form>
    <div style="margin-top: -20px;background-color: #604d94;color: #FFF;">
        <div class="container"  id="container_title">
            <p style="padding-top: 35px;font-size: 34px;">title</p>
            <p style="font-size: 18px;">info</p>
        </div>
    </div>

    <div id="wj" class="container" style="padding-top: 35px;">

    </div>

    <div class="container" style="margin-top: 20px;">

        <button type="button" onclick="wj_submit();" class="btn btn-success">提交</button>
    </div>
    <br>

</form>

<script>
    window.onload = function (){
        init();

    }
    function getUrlParam(name) {
        //构造一个含有目标参数的正则表达式对象
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        //匹配目标参数
        var r = window.location.search.substr(1).match(reg);
        //返回参数
        if (r != null) {
            return unescape(r[2]);
        } else {
            return null;
        }
    }
</script>

<script>
    var topic;
    var anser = {};
    function init() {
        $.get('/static/wj/topic/'+getUrlParam('id')+'.json',{},function (data) {
            topic = data.data;
            if(data.io){
                var html = template('script_title', topic);
                $("#container_title").html(html);

                for(var i = 0; i < topic['topic'].length; i++) {
                    var unit = template(topic['topic'][i]['type'], topic['topic'][i]);
                    $("#wj").append(unit);
                };
                console.debug(topic);
            }else{
                console.debug(topic);
            }
        },'json');
        console.log('ok');
    }
    function wj_submit() {
        $(".form-group").mouseup(function(){
            $(this).css("background-color","#FFFFFF");
        });

        for(var i = 0; i < topic['topic'].length; i++) {
            if($('input[name="q'+topic['topic'][i]['no']+'"]:checked').val() == null){
                $("html,body").animate({scrollTop: $("#q"+topic['topic'][i]['no']).offset().top}, 500);
                $("#q"+topic['topic'][i]['no']).css("background-color","#FFFFCC");
                return;
            }
            anser['q'+topic['topic'][i]['no']] = $('input[name="q'+topic['topic'][i]['no']+'"]:checked').val();
        };
        $.post('http://apoc.aikutest.com/?m=wj&c=wj&a=submit&id='+getUrlParam('id'),{'answer':JSON.stringify(anser)},function (data) {
            if(data.io){
                layer.open({
                    content:'感谢您的参与!您的答卷已经提交，点击确定查看报告结果。', 
                    btn:'确定',
                    shadeClose: false,
                    yes:function(){
                        location.href = '/report/'+getUrlParam('id')+'.html?id='+getUrlParam('id')+'&wid=' + data.data;
                    }
                });

                // layer.open({
				// 	content: '感谢您的参与!您的答卷已经提交，点击确定查看报告结果。'
				// 	,btn: '确定'
				// ,yes:function(){
                    
                // }

            }else{
                console.debug(topic);
            }
        },'json');
        

        console.log(JSON.stringify(anser));
    }

</script>